# 1F Recovery Pipeline Health Card
# Shows recovery tracking data integrity status
# Dashboard: Energy Performance - Diagnostics
type: custom:mushroom-template-card
primary: >-
  {% set healthy = is_state('binary_sensor.hvac_1f_recovery_healthy', 'on') %}
  {% set stale = is_state('binary_sensor.hvac_1f_recovery_rate_stale', 'on') %}
  {% set inputs_valid = is_state('binary_sensor.hvac_1f_recovery_inputs_valid', 'on') %}
  {% set data_count = states('sensor.hvac_1f_recovery_rate_data_count') | int(0) %}
  {% set age_hours = states('sensor.hvac_1f_recovery_age_hours') | float(999) %}
  {% if healthy %}Healthy ({{ data_count }}/7)
  {% elif stale %}Stale ({{ (age_hours / 24) | round(0) | int }}d ago)
  {% elif not inputs_valid %}Inputs Invalid
  {% else %}Partial ({{ data_count }}/7)
  {% endif %}
secondary: 1F Recovery Pipeline
icon: mdi:home-floor-1
icon_color: >-
  {% set healthy = is_state('binary_sensor.hvac_1f_recovery_healthy', 'on') %}
  {% set stale = is_state('binary_sensor.hvac_1f_recovery_rate_stale', 'on') %}
  {% set data_count = states('sensor.hvac_1f_recovery_rate_data_count') | int(0) %}
  {% if healthy %}green
  {% elif stale %}red
  {% elif data_count >= 2 %}amber
  {% else %}red
  {% endif %}
badge_icon: >-
  {% set healthy = is_state('binary_sensor.hvac_1f_recovery_healthy', 'on') %}
  {% if healthy %}mdi:check{% else %}mdi:alert{% endif %}
badge_color: >-
  {% set healthy = is_state('binary_sensor.hvac_1f_recovery_healthy', 'on') %}
  {% if healthy %}green{% else %}red{% endif %}
tap_action:
  action: more-info
  entity: binary_sensor.hvac_1f_recovery_healthy
